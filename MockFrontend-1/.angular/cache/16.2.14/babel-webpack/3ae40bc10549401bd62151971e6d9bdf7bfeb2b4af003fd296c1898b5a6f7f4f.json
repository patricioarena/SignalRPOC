{"ast":null,"code":"// Copyright (c) .NET Foundation. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : new P(function (resolve) {\n        resolve(result.value);\n      }).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n      label: 0,\n      sent: function () {\n        if (t[0] & 1) throw t[1];\n        return t[1];\n      },\n      trys: [],\n      ops: []\n    },\n    f,\n    y,\n    t,\n    g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n    while (_) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n        case 7:\n          op = _.ops.pop();\n          _.trys.pop();\n          continue;\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n            _.ops.push(op);\n            break;\n          }\n          if (t[2]) _.ops.pop();\n          _.trys.pop();\n          continue;\n      }\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\nimport { DefaultHttpClient } from \"./HttpClient\";\nimport { LogLevel } from \"./ILogger\";\nimport { HttpTransportType, TransferFormat } from \"./ITransport\";\nimport { LongPollingTransport } from \"./LongPollingTransport\";\nimport { ServerSentEventsTransport } from \"./ServerSentEventsTransport\";\nimport { Arg, createLogger } from \"./Utils\";\nimport { WebSocketTransport } from \"./WebSocketTransport\";\nvar MAX_REDIRECTS = 100;\n/** @private */\nvar HttpConnection = /** @class */function () {\n  function HttpConnection(url, options) {\n    if (options === void 0) {\n      options = {};\n    }\n    this.features = {};\n    Arg.isRequired(url, \"url\");\n    this.logger = createLogger(options.logger);\n    this.baseUrl = this.resolveUrl(url);\n    options = options || {};\n    options.accessTokenFactory = options.accessTokenFactory || function () {\n      return null;\n    };\n    options.logMessageContent = options.logMessageContent || false;\n    this.httpClient = options.httpClient || new DefaultHttpClient(this.logger);\n    this.connectionState = 2 /* Disconnected */;\n    this.options = options;\n  }\n  HttpConnection.prototype.start = function (transferFormat) {\n    transferFormat = transferFormat || TransferFormat.Binary;\n    Arg.isIn(transferFormat, TransferFormat, \"transferFormat\");\n    this.logger.log(LogLevel.Debug, \"Starting connection with transfer format '\" + TransferFormat[transferFormat] + \"'.\");\n    if (this.connectionState !== 2 /* Disconnected */) {\n      return Promise.reject(new Error(\"Cannot start a connection that is not in the 'Disconnected' state.\"));\n    }\n    this.connectionState = 0 /* Connecting */;\n    this.startPromise = this.startInternal(transferFormat);\n    return this.startPromise;\n  };\n  HttpConnection.prototype.send = function (data) {\n    if (this.connectionState !== 1 /* Connected */) {\n      throw new Error(\"Cannot send data if the connection is not in the 'Connected' State.\");\n    }\n    return this.transport.send(data);\n  };\n  HttpConnection.prototype.stop = function (error) {\n    return __awaiter(this, void 0, void 0, function () {\n      var e_1;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            this.connectionState = 2 /* Disconnected */;\n            _a.label = 1;\n          case 1:\n            _a.trys.push([1, 3,, 4]);\n            return [4 /*yield*/, this.startPromise];\n          case 2:\n            _a.sent();\n            return [3 /*break*/, 4];\n          case 3:\n            e_1 = _a.sent();\n            return [3 /*break*/, 4];\n          case 4:\n            if (!this.transport) return [3 /*break*/, 6];\n            this.stopError = error;\n            return [4 /*yield*/, this.transport.stop()];\n          case 5:\n            _a.sent();\n            this.transport = null;\n            _a.label = 6;\n          case 6:\n            return [2 /*return*/];\n        }\n      });\n    });\n  };\n\n  HttpConnection.prototype.startInternal = function (transferFormat) {\n    return __awaiter(this, void 0, void 0, function () {\n      var url, negotiateResponse, redirects, _loop_1, this_1, state_1, e_2;\n      var _this = this;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            url = this.baseUrl;\n            this.accessTokenFactory = this.options.accessTokenFactory;\n            _a.label = 1;\n          case 1:\n            _a.trys.push([1, 12,, 13]);\n            if (!this.options.skipNegotiation) return [3 /*break*/, 5];\n            if (!(this.options.transport === HttpTransportType.WebSockets)) return [3 /*break*/, 3];\n            // No need to add a connection ID in this case\n            this.transport = this.constructTransport(HttpTransportType.WebSockets);\n            // We should just call connect directly in this case.\n            // No fallback or negotiate in this case.\n            return [4 /*yield*/, this.transport.connect(url, transferFormat)];\n          case 2:\n            // We should just call connect directly in this case.\n            // No fallback or negotiate in this case.\n            _a.sent();\n            return [3 /*break*/, 4];\n          case 3:\n            throw Error(\"Negotiation can only be skipped when using the WebSocket transport directly.\");\n          case 4:\n            return [3 /*break*/, 11];\n          case 5:\n            negotiateResponse = null;\n            redirects = 0;\n            _loop_1 = function () {\n              var accessToken_1;\n              return __generator(this, function (_a) {\n                switch (_a.label) {\n                  case 0:\n                    return [4 /*yield*/, this_1.getNegotiationResponse(url)];\n                  case 1:\n                    negotiateResponse = _a.sent();\n                    // the user tries to stop the connection when it is being started\n                    if (this_1.connectionState === 2 /* Disconnected */) {\n                      return [2 /*return*/, {\n                        value: void 0\n                      }];\n                    }\n                    if (negotiateResponse.url) {\n                      url = negotiateResponse.url;\n                    }\n                    if (negotiateResponse.accessToken) {\n                      accessToken_1 = negotiateResponse.accessToken;\n                      this_1.accessTokenFactory = function () {\n                        return accessToken_1;\n                      };\n                    }\n                    redirects++;\n                    return [2 /*return*/];\n                }\n              });\n            };\n\n            this_1 = this;\n            _a.label = 6;\n          case 6:\n            return [5 /*yield**/, _loop_1()];\n          case 7:\n            state_1 = _a.sent();\n            if (typeof state_1 === \"object\") return [2 /*return*/, state_1.value];\n            _a.label = 8;\n          case 8:\n            if (negotiateResponse.url && redirects < MAX_REDIRECTS) return [3 /*break*/, 6];\n            _a.label = 9;\n          case 9:\n            if (redirects === MAX_REDIRECTS && negotiateResponse.url) {\n              throw Error(\"Negotiate redirection limit exceeded.\");\n            }\n            return [4 /*yield*/, this.createTransport(url, this.options.transport, negotiateResponse, transferFormat)];\n          case 10:\n            _a.sent();\n            _a.label = 11;\n          case 11:\n            if (this.transport instanceof LongPollingTransport) {\n              this.features.inherentKeepAlive = true;\n            }\n            this.transport.onreceive = this.onreceive;\n            this.transport.onclose = function (e) {\n              return _this.stopConnection(e);\n            };\n            // only change the state if we were connecting to not overwrite\n            // the state if the connection is already marked as Disconnected\n            this.changeState(0 /* Connecting */, 1 /* Connected */);\n            return [3 /*break*/, 13];\n          case 12:\n            e_2 = _a.sent();\n            this.logger.log(LogLevel.Error, \"Failed to start the connection: \" + e_2);\n            this.connectionState = 2 /* Disconnected */;\n            this.transport = null;\n            throw e_2;\n          case 13:\n            return [2 /*return*/];\n        }\n      });\n    });\n  };\n\n  HttpConnection.prototype.getNegotiationResponse = function (url) {\n    return __awaiter(this, void 0, void 0, function () {\n      var _a, token, headers, negotiateUrl, response, e_3;\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            return [4 /*yield*/, this.accessTokenFactory()];\n          case 1:\n            token = _b.sent();\n            if (token) {\n              headers = (_a = {}, _a[\"Authorization\"] = \"Bearer \" + token, _a);\n            }\n            negotiateUrl = this.resolveNegotiateUrl(url);\n            this.logger.log(LogLevel.Debug, \"Sending negotiation request: \" + negotiateUrl);\n            _b.label = 2;\n          case 2:\n            _b.trys.push([2, 4,, 5]);\n            return [4 /*yield*/, this.httpClient.post(negotiateUrl, {\n              content: \"\",\n              headers: headers\n            })];\n          case 3:\n            response = _b.sent();\n            if (response.statusCode !== 200) {\n              throw Error(\"Unexpected status code returned from negotiate \" + response.statusCode);\n            }\n            return [2 /*return*/, JSON.parse(response.content)];\n          case 4:\n            e_3 = _b.sent();\n            this.logger.log(LogLevel.Error, \"Failed to complete negotiation with the server: \" + e_3);\n            throw e_3;\n          case 5:\n            return [2 /*return*/];\n        }\n      });\n    });\n  };\n\n  HttpConnection.prototype.createConnectUrl = function (url, connectionId) {\n    return url + (url.indexOf(\"?\") === -1 ? \"?\" : \"&\") + (\"id=\" + connectionId);\n  };\n  HttpConnection.prototype.createTransport = function (url, requestedTransport, negotiateResponse, requestedTransferFormat) {\n    return __awaiter(this, void 0, void 0, function () {\n      var connectUrl, transports, _i, transports_1, endpoint, transport, ex_1;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            connectUrl = this.createConnectUrl(url, negotiateResponse.connectionId);\n            if (!this.isITransport(requestedTransport)) return [3 /*break*/, 2];\n            this.logger.log(LogLevel.Debug, \"Connection was provided an instance of ITransport, using that directly.\");\n            this.transport = requestedTransport;\n            return [4 /*yield*/, this.transport.connect(connectUrl, requestedTransferFormat)];\n          case 1:\n            _a.sent();\n            // only change the state if we were connecting to not overwrite\n            // the state if the connection is already marked as Disconnected\n            this.changeState(0 /* Connecting */, 1 /* Connected */);\n            return [2 /*return*/];\n          case 2:\n            transports = negotiateResponse.availableTransports;\n            _i = 0, transports_1 = transports;\n            _a.label = 3;\n          case 3:\n            if (!(_i < transports_1.length)) return [3 /*break*/, 9];\n            endpoint = transports_1[_i];\n            this.connectionState = 0 /* Connecting */;\n            transport = this.resolveTransport(endpoint, requestedTransport, requestedTransferFormat);\n            if (!(typeof transport === \"number\")) return [3 /*break*/, 8];\n            this.transport = this.constructTransport(transport);\n            if (!(negotiateResponse.connectionId === null)) return [3 /*break*/, 5];\n            return [4 /*yield*/, this.getNegotiationResponse(url)];\n          case 4:\n            negotiateResponse = _a.sent();\n            connectUrl = this.createConnectUrl(url, negotiateResponse.connectionId);\n            _a.label = 5;\n          case 5:\n            _a.trys.push([5, 7,, 8]);\n            return [4 /*yield*/, this.transport.connect(connectUrl, requestedTransferFormat)];\n          case 6:\n            _a.sent();\n            this.changeState(0 /* Connecting */, 1 /* Connected */);\n            return [2 /*return*/];\n          case 7:\n            ex_1 = _a.sent();\n            this.logger.log(LogLevel.Error, \"Failed to start the transport '\" + HttpTransportType[transport] + \"': \" + ex_1);\n            this.connectionState = 2 /* Disconnected */;\n            negotiateResponse.connectionId = null;\n            return [3 /*break*/, 8];\n          case 8:\n            _i++;\n            return [3 /*break*/, 3];\n          case 9:\n            throw new Error(\"Unable to initialize any of the available transports.\");\n        }\n      });\n    });\n  };\n  HttpConnection.prototype.constructTransport = function (transport) {\n    switch (transport) {\n      case HttpTransportType.WebSockets:\n        return new WebSocketTransport(this.accessTokenFactory, this.logger, this.options.logMessageContent);\n      case HttpTransportType.ServerSentEvents:\n        return new ServerSentEventsTransport(this.httpClient, this.accessTokenFactory, this.logger, this.options.logMessageContent);\n      case HttpTransportType.LongPolling:\n        return new LongPollingTransport(this.httpClient, this.accessTokenFactory, this.logger, this.options.logMessageContent);\n      default:\n        throw new Error(\"Unknown transport: \" + transport + \".\");\n    }\n  };\n  HttpConnection.prototype.resolveTransport = function (endpoint, requestedTransport, requestedTransferFormat) {\n    var transport = HttpTransportType[endpoint.transport];\n    if (transport === null || transport === undefined) {\n      this.logger.log(LogLevel.Debug, \"Skipping transport '\" + endpoint.transport + \"' because it is not supported by this client.\");\n    } else {\n      var transferFormats = endpoint.transferFormats.map(function (s) {\n        return TransferFormat[s];\n      });\n      if (transportMatches(requestedTransport, transport)) {\n        if (transferFormats.indexOf(requestedTransferFormat) >= 0) {\n          if (transport === HttpTransportType.WebSockets && typeof WebSocket === \"undefined\" || transport === HttpTransportType.ServerSentEvents && typeof EventSource === \"undefined\") {\n            this.logger.log(LogLevel.Debug, \"Skipping transport '\" + HttpTransportType[transport] + \"' because it is not supported in your environment.'\");\n          } else {\n            this.logger.log(LogLevel.Debug, \"Selecting transport '\" + HttpTransportType[transport] + \"'\");\n            return transport;\n          }\n        } else {\n          this.logger.log(LogLevel.Debug, \"Skipping transport '\" + HttpTransportType[transport] + \"' because it does not support the requested transfer format '\" + TransferFormat[requestedTransferFormat] + \"'.\");\n        }\n      } else {\n        this.logger.log(LogLevel.Debug, \"Skipping transport '\" + HttpTransportType[transport] + \"' because it was disabled by the client.\");\n      }\n    }\n    return null;\n  };\n  HttpConnection.prototype.isITransport = function (transport) {\n    return transport && typeof transport === \"object\" && \"connect\" in transport;\n  };\n  HttpConnection.prototype.changeState = function (from, to) {\n    if (this.connectionState === from) {\n      this.connectionState = to;\n      return true;\n    }\n    return false;\n  };\n  HttpConnection.prototype.stopConnection = function (error) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        this.transport = null;\n        // If we have a stopError, it takes precedence over the error from the transport\n        error = this.stopError || error;\n        if (error) {\n          this.logger.log(LogLevel.Error, \"Connection disconnected with error '\" + error + \"'.\");\n        } else {\n          this.logger.log(LogLevel.Information, \"Connection disconnected.\");\n        }\n        this.connectionState = 2 /* Disconnected */;\n        if (this.onclose) {\n          this.onclose(error);\n        }\n        return [2 /*return*/];\n      });\n    });\n  };\n\n  HttpConnection.prototype.resolveUrl = function (url) {\n    // startsWith is not supported in IE\n    if (url.lastIndexOf(\"https://\", 0) === 0 || url.lastIndexOf(\"http://\", 0) === 0) {\n      return url;\n    }\n    if (typeof window === \"undefined\" || !window || !window.document) {\n      throw new Error(\"Cannot resolve '\" + url + \"'.\");\n    }\n    // Setting the url to the href propery of an anchor tag handles normalization\n    // for us. There are 3 main cases.\n    // 1. Relative  path normalization e.g \"b\" -> \"http://localhost:5000/a/b\"\n    // 2. Absolute path normalization e.g \"/a/b\" -> \"http://localhost:5000/a/b\"\n    // 3. Networkpath reference normalization e.g \"//localhost:5000/a/b\" -> \"http://localhost:5000/a/b\"\n    var aTag = window.document.createElement(\"a\");\n    aTag.href = url;\n    this.logger.log(LogLevel.Information, \"Normalizing '\" + url + \"' to '\" + aTag.href + \"'.\");\n    return aTag.href;\n  };\n  HttpConnection.prototype.resolveNegotiateUrl = function (url) {\n    var index = url.indexOf(\"?\");\n    var negotiateUrl = url.substring(0, index === -1 ? url.length : index);\n    if (negotiateUrl[negotiateUrl.length - 1] !== \"/\") {\n      negotiateUrl += \"/\";\n    }\n    negotiateUrl += \"negotiate\";\n    negotiateUrl += index === -1 ? \"\" : url.substring(index);\n    return negotiateUrl;\n  };\n  return HttpConnection;\n}();\nexport { HttpConnection };\nfunction transportMatches(requestedTransport, actualTransport) {\n  return !requestedTransport || (actualTransport & requestedTransport) !== 0;\n}","map":{"version":3,"names":["__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","apply","__generator","body","_","label","sent","t","trys","ops","f","y","g","verb","Symbol","iterator","n","v","op","TypeError","call","pop","length","push","DefaultHttpClient","LogLevel","HttpTransportType","TransferFormat","LongPollingTransport","ServerSentEventsTransport","Arg","createLogger","WebSocketTransport","MAX_REDIRECTS","HttpConnection","url","options","features","isRequired","logger","baseUrl","resolveUrl","accessTokenFactory","logMessageContent","httpClient","connectionState","prototype","start","transferFormat","Binary","isIn","log","Debug","Error","startPromise","startInternal","send","data","transport","stop","error","e_1","_a","stopError","negotiateResponse","redirects","_loop_1","this_1","state_1","e_2","_this","skipNegotiation","WebSockets","constructTransport","connect","accessToken_1","getNegotiationResponse","accessToken","createTransport","inherentKeepAlive","onreceive","onclose","stopConnection","changeState","token","headers","negotiateUrl","response","e_3","_b","resolveNegotiateUrl","post","content","statusCode","JSON","parse","createConnectUrl","connectionId","indexOf","requestedTransport","requestedTransferFormat","connectUrl","transports","_i","transports_1","endpoint","ex_1","isITransport","availableTransports","resolveTransport","ServerSentEvents","LongPolling","undefined","transferFormats","map","s","transportMatches","WebSocket","EventSource","from","to","Information","lastIndexOf","window","document","aTag","createElement","href","index","substring","actualTransport"],"sources":["C:/Users/patri/source/repos/SignalRPOC/MockFrontend-1/node_modules/@aspnet/signalr/dist/esm/HttpConnection.js"],"sourcesContent":["// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nimport { DefaultHttpClient } from \"./HttpClient\";\r\nimport { LogLevel } from \"./ILogger\";\r\nimport { HttpTransportType, TransferFormat } from \"./ITransport\";\r\nimport { LongPollingTransport } from \"./LongPollingTransport\";\r\nimport { ServerSentEventsTransport } from \"./ServerSentEventsTransport\";\r\nimport { Arg, createLogger } from \"./Utils\";\r\nimport { WebSocketTransport } from \"./WebSocketTransport\";\r\nvar MAX_REDIRECTS = 100;\r\n/** @private */\r\nvar HttpConnection = /** @class */ (function () {\r\n    function HttpConnection(url, options) {\r\n        if (options === void 0) { options = {}; }\r\n        this.features = {};\r\n        Arg.isRequired(url, \"url\");\r\n        this.logger = createLogger(options.logger);\r\n        this.baseUrl = this.resolveUrl(url);\r\n        options = options || {};\r\n        options.accessTokenFactory = options.accessTokenFactory || (function () { return null; });\r\n        options.logMessageContent = options.logMessageContent || false;\r\n        this.httpClient = options.httpClient || new DefaultHttpClient(this.logger);\r\n        this.connectionState = 2 /* Disconnected */;\r\n        this.options = options;\r\n    }\r\n    HttpConnection.prototype.start = function (transferFormat) {\r\n        transferFormat = transferFormat || TransferFormat.Binary;\r\n        Arg.isIn(transferFormat, TransferFormat, \"transferFormat\");\r\n        this.logger.log(LogLevel.Debug, \"Starting connection with transfer format '\" + TransferFormat[transferFormat] + \"'.\");\r\n        if (this.connectionState !== 2 /* Disconnected */) {\r\n            return Promise.reject(new Error(\"Cannot start a connection that is not in the 'Disconnected' state.\"));\r\n        }\r\n        this.connectionState = 0 /* Connecting */;\r\n        this.startPromise = this.startInternal(transferFormat);\r\n        return this.startPromise;\r\n    };\r\n    HttpConnection.prototype.send = function (data) {\r\n        if (this.connectionState !== 1 /* Connected */) {\r\n            throw new Error(\"Cannot send data if the connection is not in the 'Connected' State.\");\r\n        }\r\n        return this.transport.send(data);\r\n    };\r\n    HttpConnection.prototype.stop = function (error) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var e_1;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        this.connectionState = 2 /* Disconnected */;\r\n                        _a.label = 1;\r\n                    case 1:\r\n                        _a.trys.push([1, 3, , 4]);\r\n                        return [4 /*yield*/, this.startPromise];\r\n                    case 2:\r\n                        _a.sent();\r\n                        return [3 /*break*/, 4];\r\n                    case 3:\r\n                        e_1 = _a.sent();\r\n                        return [3 /*break*/, 4];\r\n                    case 4:\r\n                        if (!this.transport) return [3 /*break*/, 6];\r\n                        this.stopError = error;\r\n                        return [4 /*yield*/, this.transport.stop()];\r\n                    case 5:\r\n                        _a.sent();\r\n                        this.transport = null;\r\n                        _a.label = 6;\r\n                    case 6: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    HttpConnection.prototype.startInternal = function (transferFormat) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var url, negotiateResponse, redirects, _loop_1, this_1, state_1, e_2;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        url = this.baseUrl;\r\n                        this.accessTokenFactory = this.options.accessTokenFactory;\r\n                        _a.label = 1;\r\n                    case 1:\r\n                        _a.trys.push([1, 12, , 13]);\r\n                        if (!this.options.skipNegotiation) return [3 /*break*/, 5];\r\n                        if (!(this.options.transport === HttpTransportType.WebSockets)) return [3 /*break*/, 3];\r\n                        // No need to add a connection ID in this case\r\n                        this.transport = this.constructTransport(HttpTransportType.WebSockets);\r\n                        // We should just call connect directly in this case.\r\n                        // No fallback or negotiate in this case.\r\n                        return [4 /*yield*/, this.transport.connect(url, transferFormat)];\r\n                    case 2:\r\n                        // We should just call connect directly in this case.\r\n                        // No fallback or negotiate in this case.\r\n                        _a.sent();\r\n                        return [3 /*break*/, 4];\r\n                    case 3: throw Error(\"Negotiation can only be skipped when using the WebSocket transport directly.\");\r\n                    case 4: return [3 /*break*/, 11];\r\n                    case 5:\r\n                        negotiateResponse = null;\r\n                        redirects = 0;\r\n                        _loop_1 = function () {\r\n                            var accessToken_1;\r\n                            return __generator(this, function (_a) {\r\n                                switch (_a.label) {\r\n                                    case 0: return [4 /*yield*/, this_1.getNegotiationResponse(url)];\r\n                                    case 1:\r\n                                        negotiateResponse = _a.sent();\r\n                                        // the user tries to stop the connection when it is being started\r\n                                        if (this_1.connectionState === 2 /* Disconnected */) {\r\n                                            return [2 /*return*/, { value: void 0 }];\r\n                                        }\r\n                                        if (negotiateResponse.url) {\r\n                                            url = negotiateResponse.url;\r\n                                        }\r\n                                        if (negotiateResponse.accessToken) {\r\n                                            accessToken_1 = negotiateResponse.accessToken;\r\n                                            this_1.accessTokenFactory = function () { return accessToken_1; };\r\n                                        }\r\n                                        redirects++;\r\n                                        return [2 /*return*/];\r\n                                }\r\n                            });\r\n                        };\r\n                        this_1 = this;\r\n                        _a.label = 6;\r\n                    case 6: return [5 /*yield**/, _loop_1()];\r\n                    case 7:\r\n                        state_1 = _a.sent();\r\n                        if (typeof state_1 === \"object\")\r\n                            return [2 /*return*/, state_1.value];\r\n                        _a.label = 8;\r\n                    case 8:\r\n                        if (negotiateResponse.url && redirects < MAX_REDIRECTS) return [3 /*break*/, 6];\r\n                        _a.label = 9;\r\n                    case 9:\r\n                        if (redirects === MAX_REDIRECTS && negotiateResponse.url) {\r\n                            throw Error(\"Negotiate redirection limit exceeded.\");\r\n                        }\r\n                        return [4 /*yield*/, this.createTransport(url, this.options.transport, negotiateResponse, transferFormat)];\r\n                    case 10:\r\n                        _a.sent();\r\n                        _a.label = 11;\r\n                    case 11:\r\n                        if (this.transport instanceof LongPollingTransport) {\r\n                            this.features.inherentKeepAlive = true;\r\n                        }\r\n                        this.transport.onreceive = this.onreceive;\r\n                        this.transport.onclose = function (e) { return _this.stopConnection(e); };\r\n                        // only change the state if we were connecting to not overwrite\r\n                        // the state if the connection is already marked as Disconnected\r\n                        this.changeState(0 /* Connecting */, 1 /* Connected */);\r\n                        return [3 /*break*/, 13];\r\n                    case 12:\r\n                        e_2 = _a.sent();\r\n                        this.logger.log(LogLevel.Error, \"Failed to start the connection: \" + e_2);\r\n                        this.connectionState = 2 /* Disconnected */;\r\n                        this.transport = null;\r\n                        throw e_2;\r\n                    case 13: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    HttpConnection.prototype.getNegotiationResponse = function (url) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _a, token, headers, negotiateUrl, response, e_3;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0: return [4 /*yield*/, this.accessTokenFactory()];\r\n                    case 1:\r\n                        token = _b.sent();\r\n                        if (token) {\r\n                            headers = (_a = {},\r\n                                _a[\"Authorization\"] = \"Bearer \" + token,\r\n                                _a);\r\n                        }\r\n                        negotiateUrl = this.resolveNegotiateUrl(url);\r\n                        this.logger.log(LogLevel.Debug, \"Sending negotiation request: \" + negotiateUrl);\r\n                        _b.label = 2;\r\n                    case 2:\r\n                        _b.trys.push([2, 4, , 5]);\r\n                        return [4 /*yield*/, this.httpClient.post(negotiateUrl, {\r\n                                content: \"\",\r\n                                headers: headers,\r\n                            })];\r\n                    case 3:\r\n                        response = _b.sent();\r\n                        if (response.statusCode !== 200) {\r\n                            throw Error(\"Unexpected status code returned from negotiate \" + response.statusCode);\r\n                        }\r\n                        return [2 /*return*/, JSON.parse(response.content)];\r\n                    case 4:\r\n                        e_3 = _b.sent();\r\n                        this.logger.log(LogLevel.Error, \"Failed to complete negotiation with the server: \" + e_3);\r\n                        throw e_3;\r\n                    case 5: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    HttpConnection.prototype.createConnectUrl = function (url, connectionId) {\r\n        return url + (url.indexOf(\"?\") === -1 ? \"?\" : \"&\") + (\"id=\" + connectionId);\r\n    };\r\n    HttpConnection.prototype.createTransport = function (url, requestedTransport, negotiateResponse, requestedTransferFormat) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var connectUrl, transports, _i, transports_1, endpoint, transport, ex_1;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        connectUrl = this.createConnectUrl(url, negotiateResponse.connectionId);\r\n                        if (!this.isITransport(requestedTransport)) return [3 /*break*/, 2];\r\n                        this.logger.log(LogLevel.Debug, \"Connection was provided an instance of ITransport, using that directly.\");\r\n                        this.transport = requestedTransport;\r\n                        return [4 /*yield*/, this.transport.connect(connectUrl, requestedTransferFormat)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        // only change the state if we were connecting to not overwrite\r\n                        // the state if the connection is already marked as Disconnected\r\n                        this.changeState(0 /* Connecting */, 1 /* Connected */);\r\n                        return [2 /*return*/];\r\n                    case 2:\r\n                        transports = negotiateResponse.availableTransports;\r\n                        _i = 0, transports_1 = transports;\r\n                        _a.label = 3;\r\n                    case 3:\r\n                        if (!(_i < transports_1.length)) return [3 /*break*/, 9];\r\n                        endpoint = transports_1[_i];\r\n                        this.connectionState = 0 /* Connecting */;\r\n                        transport = this.resolveTransport(endpoint, requestedTransport, requestedTransferFormat);\r\n                        if (!(typeof transport === \"number\")) return [3 /*break*/, 8];\r\n                        this.transport = this.constructTransport(transport);\r\n                        if (!(negotiateResponse.connectionId === null)) return [3 /*break*/, 5];\r\n                        return [4 /*yield*/, this.getNegotiationResponse(url)];\r\n                    case 4:\r\n                        negotiateResponse = _a.sent();\r\n                        connectUrl = this.createConnectUrl(url, negotiateResponse.connectionId);\r\n                        _a.label = 5;\r\n                    case 5:\r\n                        _a.trys.push([5, 7, , 8]);\r\n                        return [4 /*yield*/, this.transport.connect(connectUrl, requestedTransferFormat)];\r\n                    case 6:\r\n                        _a.sent();\r\n                        this.changeState(0 /* Connecting */, 1 /* Connected */);\r\n                        return [2 /*return*/];\r\n                    case 7:\r\n                        ex_1 = _a.sent();\r\n                        this.logger.log(LogLevel.Error, \"Failed to start the transport '\" + HttpTransportType[transport] + \"': \" + ex_1);\r\n                        this.connectionState = 2 /* Disconnected */;\r\n                        negotiateResponse.connectionId = null;\r\n                        return [3 /*break*/, 8];\r\n                    case 8:\r\n                        _i++;\r\n                        return [3 /*break*/, 3];\r\n                    case 9: throw new Error(\"Unable to initialize any of the available transports.\");\r\n                }\r\n            });\r\n        });\r\n    };\r\n    HttpConnection.prototype.constructTransport = function (transport) {\r\n        switch (transport) {\r\n            case HttpTransportType.WebSockets:\r\n                return new WebSocketTransport(this.accessTokenFactory, this.logger, this.options.logMessageContent);\r\n            case HttpTransportType.ServerSentEvents:\r\n                return new ServerSentEventsTransport(this.httpClient, this.accessTokenFactory, this.logger, this.options.logMessageContent);\r\n            case HttpTransportType.LongPolling:\r\n                return new LongPollingTransport(this.httpClient, this.accessTokenFactory, this.logger, this.options.logMessageContent);\r\n            default:\r\n                throw new Error(\"Unknown transport: \" + transport + \".\");\r\n        }\r\n    };\r\n    HttpConnection.prototype.resolveTransport = function (endpoint, requestedTransport, requestedTransferFormat) {\r\n        var transport = HttpTransportType[endpoint.transport];\r\n        if (transport === null || transport === undefined) {\r\n            this.logger.log(LogLevel.Debug, \"Skipping transport '\" + endpoint.transport + \"' because it is not supported by this client.\");\r\n        }\r\n        else {\r\n            var transferFormats = endpoint.transferFormats.map(function (s) { return TransferFormat[s]; });\r\n            if (transportMatches(requestedTransport, transport)) {\r\n                if (transferFormats.indexOf(requestedTransferFormat) >= 0) {\r\n                    if ((transport === HttpTransportType.WebSockets && typeof WebSocket === \"undefined\") ||\r\n                        (transport === HttpTransportType.ServerSentEvents && typeof EventSource === \"undefined\")) {\r\n                        this.logger.log(LogLevel.Debug, \"Skipping transport '\" + HttpTransportType[transport] + \"' because it is not supported in your environment.'\");\r\n                    }\r\n                    else {\r\n                        this.logger.log(LogLevel.Debug, \"Selecting transport '\" + HttpTransportType[transport] + \"'\");\r\n                        return transport;\r\n                    }\r\n                }\r\n                else {\r\n                    this.logger.log(LogLevel.Debug, \"Skipping transport '\" + HttpTransportType[transport] + \"' because it does not support the requested transfer format '\" + TransferFormat[requestedTransferFormat] + \"'.\");\r\n                }\r\n            }\r\n            else {\r\n                this.logger.log(LogLevel.Debug, \"Skipping transport '\" + HttpTransportType[transport] + \"' because it was disabled by the client.\");\r\n            }\r\n        }\r\n        return null;\r\n    };\r\n    HttpConnection.prototype.isITransport = function (transport) {\r\n        return transport && typeof (transport) === \"object\" && \"connect\" in transport;\r\n    };\r\n    HttpConnection.prototype.changeState = function (from, to) {\r\n        if (this.connectionState === from) {\r\n            this.connectionState = to;\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n    HttpConnection.prototype.stopConnection = function (error) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                this.transport = null;\r\n                // If we have a stopError, it takes precedence over the error from the transport\r\n                error = this.stopError || error;\r\n                if (error) {\r\n                    this.logger.log(LogLevel.Error, \"Connection disconnected with error '\" + error + \"'.\");\r\n                }\r\n                else {\r\n                    this.logger.log(LogLevel.Information, \"Connection disconnected.\");\r\n                }\r\n                this.connectionState = 2 /* Disconnected */;\r\n                if (this.onclose) {\r\n                    this.onclose(error);\r\n                }\r\n                return [2 /*return*/];\r\n            });\r\n        });\r\n    };\r\n    HttpConnection.prototype.resolveUrl = function (url) {\r\n        // startsWith is not supported in IE\r\n        if (url.lastIndexOf(\"https://\", 0) === 0 || url.lastIndexOf(\"http://\", 0) === 0) {\r\n            return url;\r\n        }\r\n        if (typeof window === \"undefined\" || !window || !window.document) {\r\n            throw new Error(\"Cannot resolve '\" + url + \"'.\");\r\n        }\r\n        // Setting the url to the href propery of an anchor tag handles normalization\r\n        // for us. There are 3 main cases.\r\n        // 1. Relative  path normalization e.g \"b\" -> \"http://localhost:5000/a/b\"\r\n        // 2. Absolute path normalization e.g \"/a/b\" -> \"http://localhost:5000/a/b\"\r\n        // 3. Networkpath reference normalization e.g \"//localhost:5000/a/b\" -> \"http://localhost:5000/a/b\"\r\n        var aTag = window.document.createElement(\"a\");\r\n        aTag.href = url;\r\n        this.logger.log(LogLevel.Information, \"Normalizing '\" + url + \"' to '\" + aTag.href + \"'.\");\r\n        return aTag.href;\r\n    };\r\n    HttpConnection.prototype.resolveNegotiateUrl = function (url) {\r\n        var index = url.indexOf(\"?\");\r\n        var negotiateUrl = url.substring(0, index === -1 ? url.length : index);\r\n        if (negotiateUrl[negotiateUrl.length - 1] !== \"/\") {\r\n            negotiateUrl += \"/\";\r\n        }\r\n        negotiateUrl += \"negotiate\";\r\n        negotiateUrl += index === -1 ? \"\" : url.substring(index);\r\n        return negotiateUrl;\r\n    };\r\n    return HttpConnection;\r\n}());\r\nexport { HttpConnection };\r\nfunction transportMatches(requestedTransport, actualTransport) {\r\n    return !requestedTransport || ((actualTransport & requestedTransport) !== 0);\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}